// Donn√©es de service des conducteurs - Version inline
const servicesData: ServiceRaw[] = [
  {
    "Services  S2 - Hiver 2025 ":2023,
    "Unnamed: 1":"13:36:00",
    "Unnamed: 2":"GOD02",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":2,
    "Unnamed: 6":"15:48:00",
    "Unnamed: 7":"GOD01",
    "Unnamed: 8":"8h00",
    "Unnamed: 9":2023
  },
  {
    "Services  S2 - Hiver 2025 ":2023,
    "Unnamed: 1":"16:29:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":4,
    "Unnamed: 6":"18:44:00",
    "Unnamed: 7":"GOD02",
    "Unnamed: 8":null,
    "Unnamed: 9":2023
  },
  {
    "Services  S2 - Hiver 2025 ":2023,
    "Unnamed: 1":"19:04:00",
    "Unnamed: 2":"GOD02",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":6,
    "Unnamed: 6":"21:21:00",
    "Unnamed: 7":"TRAM",
    "Unnamed: 8":null,
    "Unnamed: 9":2023
  },
  {
    "Services  S2 - Hiver 2025 ":2103,
    "Unnamed: 1":"13:43:00",
    "Unnamed: 2":"GOD02",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":8,
    "Unnamed: 6":"15:12:00",
    "Unnamed: 7":"GOD02",
    "Unnamed: 8":"7h58",
    "Unnamed: 9":2103
  },
  {
    "Services  S2 - Hiver 2025 ":2103,
    "Unnamed: 1":"15:48:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":2,
    "Unnamed: 6":"18:45:00",
    "Unnamed: 7":"GOD01",
    "Unnamed: 8":null,
    "Unnamed: 9":2103
  },
  {
    "Services  S2 - Hiver 2025 ":2103,
    "Unnamed: 1":"19:25:00",
    "Unnamed: 2":"GOD02",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":10,
    "Unnamed: 6":"21:26:00",
    "Unnamed: 7":"TRAM",
    "Unnamed: 8":null,
    "Unnamed: 9":2103
  },
  {
    "Services  S2 - Hiver 2025 ":2401,
    "Unnamed: 1":"06:57:00",
    "Unnamed: 2":"GOD02",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":1,
    "Unnamed: 6":"08:24:00",
    "Unnamed: 7":"GOD02",
    "Unnamed: 8":"8h15",
    "Unnamed: 9":2401
  },
  {
    "Services  S2 - Hiver 2025 ":2401,
    "Unnamed: 1":"08:45:00",
    "Unnamed: 2":"GOD02",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":7,
    "Unnamed: 6":"11:57:00",
    "Unnamed: 7":"HCA02",
    "Unnamed: 8":null,
    "Unnamed: 9":2401
  },
  {
    "Services  S2 - Hiver 2025 ":2401,
    "Unnamed: 1":"14:03:00",
    "Unnamed: 2":"GOD02",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":11,
    "Unnamed: 6":"17:01:00",
    "Unnamed: 7":"GOD02",
    "Unnamed: 8":null,
    "Unnamed: 9":2401
  },
  {
    "Services  S2 - Hiver 2025 ":2402,
    "Unnamed: 1":"07:14:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":5,
    "Unnamed: 6":"09:34:00",
    "Unnamed: 7":"GOD02",
    "Unnamed: 8":"8h05",
    "Unnamed: 9":2402
  },
  {
    "Services  S2 - Hiver 2025 ":2402,
    "Unnamed: 1":"10:03:00",
    "Unnamed: 2":"GOD02",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":6,
    "Unnamed: 6":"12:04:00",
    "Unnamed: 7":"HCA01",
    "Unnamed: 8":null,
    "Unnamed: 9":2402
  },
  {
    "Services  S2 - Hiver 2025 ":2402,
    "Unnamed: 1":"14:39:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":9,
    "Unnamed: 6":"17:37:00",
    "Unnamed: 7":"GOD01",
    "Unnamed: 8":null,
    "Unnamed: 9":2402
  },
  {
    "Services  S2 - Hiver 2025 ":2403,
    "Unnamed: 1":"07:58:00",
    "Unnamed: 2":"TRAM",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":9,
    "Unnamed: 6":"10:54:00",
    "Unnamed: 7":"GOD02",
    "Unnamed: 8":"7h05",
    "Unnamed: 9":2403
  },
  {
    "Services  S2 - Hiver 2025 ":2403,
    "Unnamed: 1":"13:00:00",
    "Unnamed: 2":"HCA02",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":4,
    "Unnamed: 6":"15:00:00",
    "Unnamed: 7":"GOD01",
    "Unnamed: 8":null,
    "Unnamed: 9":2403
  },
  {
    "Services  S2 - Hiver 2025 ":2403,
    "Unnamed: 1":"15:20:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":6,
    "Unnamed: 6":"16:50:00",
    "Unnamed: 7":"GOD01",
    "Unnamed: 8":null,
    "Unnamed: 9":2403
  },
  {
    "Services  S2 - Hiver 2025 ":2651,
    "Unnamed: 1":"11:55:00",
    "Unnamed: 2":"HCA01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":1,
    "Unnamed: 6":"15:13:00",
    "Unnamed: 7":"GOD01",
    "Unnamed: 8":"6h15",
    "Unnamed: 9":2651
  },
  {
    "Services  S2 - Hiver 2025 ":2651,
    "Unnamed: 1":"15:41:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":10,
    "Unnamed: 6":"17:55:00",
    "Unnamed: 7":"GOD02",
    "Unnamed: 8":null,
    "Unnamed: 9":2651
  },
  {
    "Services  S2 - Hiver 2025 ":2653,
    "Unnamed: 1":"11:56:00",
    "Unnamed: 2":"GOD02",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":3,
    "Unnamed: 6":"14:51:00",
    "Unnamed: 7":"GOD02",
    "Unnamed: 8":"6h18",
    "Unnamed: 9":2653
  },
  {
    "Services  S2 - Hiver 2025 ":2653,
    "Unnamed: 1":"15:13:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":1,
    "Unnamed: 6":"17:59:00",
    "Unnamed: 7":"HCA01",
    "Unnamed: 8":null,
    "Unnamed: 9":2653
  },
  {
    "Services  S2 - Hiver 2025 ":2701,
    "Unnamed: 1":"17:37:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":9,
    "Unnamed: 6":"20:41:00",
    "Unnamed: 7":"GOD01",
    "Unnamed: 8":"7h43",
    "Unnamed: 9":2701
  },
  {
    "Services  S2 - Hiver 2025 ":2701,
    "Unnamed: 1":"21:07:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":1,
    "Unnamed: 6":"23:15:00",
    "Unnamed: 7":"TRAM",
    "Unnamed: 8":null,
    "Unnamed: 9":2701
  },
  {
    "Services  S2 - Hiver 2025 ":2702,
    "Unnamed: 1":"17:59:00",
    "Unnamed: 2":"HCA01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":1,
    "Unnamed: 6":"21:07:00",
    "Unnamed: 7":"GOD01",
    "Unnamed: 8":"8h03",
    "Unnamed: 9":2702
  },
  {
    "Services  S2 - Hiver 2025 ":2702,
    "Unnamed: 1":"21:40:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":2,
    "Unnamed: 6":"23:45:00",
    "Unnamed: 7":"TRAM",
    "Unnamed: 8":null,
    "Unnamed: 9":2702
  },
  {
    "Services  S2 - Hiver 2025 ":2705,
    "Unnamed: 1":"18:25:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":7,
    "Unnamed: 6":"21:24:00",
    "Unnamed: 7":"GOD01",
    "Unnamed: 8":"8h01",
    "Unnamed: 9":2705
  },
  {
    "Services  S2 - Hiver 2025 ":2705,
    "Unnamed: 1":"22:41:00",
    "Unnamed: 2":"GOD02",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":12,
    "Unnamed: 6":"00:32:00",
    "Unnamed: 7":"TRAM",
    "Unnamed: 8":null,
    "Unnamed: 9":2705
  },
  {
    "Services  S2 - Hiver 2025 ":2706,
    "Unnamed: 1":"18:45:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":2,
    "Unnamed: 6":"21:40:00",
    "Unnamed: 7":"GOD01",
    "Unnamed: 8":"8h00",
    "Unnamed: 9":2706
  },
  {
    "Services  S2 - Hiver 2025 ":2706,
    "Unnamed: 1":"22:05:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":9,
    "Unnamed: 6":"00:18:00",
    "Unnamed: 7":"TRAM",
    "Unnamed: 8":null,
    "Unnamed: 9":2706
  },
  {
    "Services  S2 - Hiver 2025 ":2707,
    "Unnamed: 1":"19:20:00",
    "Unnamed: 2":"HCA01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":13,
    "Unnamed: 6":"20:14:00",
    "Unnamed: 7":"GOD02",
    "Unnamed: 8":"7h48",
    "Unnamed: 9":2707
  },
  {
    "Services  S2 - Hiver 2025 ":2707,
    "Unnamed: 1":"20:41:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":9,
    "Unnamed: 6":"22:05:00",
    "Unnamed: 7":"GOD01",
    "Unnamed: 8":null,
    "Unnamed: 9":2707
  },
  {
    "Services  S2 - Hiver 2025 ":2707,
    "Unnamed: 1":"22:22:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":13,
    "Unnamed: 6":"00:03:00",
    "Unnamed: 7":"TRAM",
    "Unnamed: 8":null,
    "Unnamed: 9":2707
  },
  {
    "Services  S2 - Hiver 2025 ":2709,
    "Unnamed: 1":"20:14:00",
    "Unnamed: 2":"GOD02",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":13,
    "Unnamed: 6":"22:22:00",
    "Unnamed: 7":"GOD01",
    "Unnamed: 8":"7h06",
    "Unnamed: 9":2709
  },
  {
    "Services  S2 - Hiver 2025 ":2709,
    "Unnamed: 1":"22:51:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":7,
    "Unnamed: 6":"00:12:00",
    "Unnamed: 7":"TRAM",
    "Unnamed: 8":null,
    "Unnamed: 9":2709
  },
  {
    "Services  S2 - Hiver 2025 ":2731,
    "Unnamed: 1":"15:00:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":4,
    "Unnamed: 6":"16:29:00",
    "Unnamed: 7":"GOD01",
    "Unnamed: 8":"8h12",
    "Unnamed: 9":2731
  },
  {
    "Services  S2 - Hiver 2025 ":2731,
    "Unnamed: 1":"16:50:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":6,
    "Unnamed: 6":"19:04:00",
    "Unnamed: 7":"GOD02",
    "Unnamed: 8":null,
    "Unnamed: 9":2731
  },
  {
    "Services  S2 - Hiver 2025 ":2731,
    "Unnamed: 1":"19:43:00",
    "Unnamed: 2":"GOD02",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":12,
    "Unnamed: 6":"22:41:00",
    "Unnamed: 7":"GOD02",
    "Unnamed: 8":null,
    "Unnamed: 9":2731
  },
  {
    "Services  S2 - Hiver 2025 ":2733,
    "Unnamed: 1":"15:12:00",
    "Unnamed: 2":"GOD02",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":8,
    "Unnamed: 6":"16:41:00",
    "Unnamed: 7":"GOD02",
    "Unnamed: 8":"8h14",
    "Unnamed: 9":2733
  },
  {
    "Services  S2 - Hiver 2025 ":2733,
    "Unnamed: 1":"17:01:00",
    "Unnamed: 2":"GOD02",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":11,
    "Unnamed: 6":"20:33:00",
    "Unnamed: 7":"TRAM",
    "Unnamed: 8":null,
    "Unnamed: 9":2733
  },
  {
    "Services  S2 - Hiver 2025 ":2733,
    "Unnamed: 1":"21:24:00",
    "Unnamed: 2":"GOD01",
    "Unnamed: 3":"T2",
    "Unnamed: 4":"-",
    "Unnamed: 5":7,
    "Unnamed: 6":"22:51:00",
    "Unnamed: 7":"GOD01",
    "Unnamed: 8":null,
    "Unnamed: 9":2733
  }
];

interface ServiceRaw {
  "Services  S2 - Hiver 2025 ": number;
  "Unnamed: 1": string;
  "Unnamed: 2": string;
  "Unnamed: 3": string;
  "Unnamed: 4": string;
  "Unnamed: 5": number;
  "Unnamed: 6": string | number;
  "Unnamed: 7": string;
  "Unnamed: 8": string | null;
  "Unnamed: 9": number;
}

export interface Conducteur {
  id: number;
  nom: string;
  prenom: string;
  matricule: string;
  statut: string;
  ligne: string;
  tram: string;
  heures: string;
  phone: string;
  position: string;
  stationDebut: string;
  stationFin: string;
  dureeService: string;
  services: {
    heureDebut: string;
    heureFin: string;
    stationDebut: string;
    stationFin: string;
    tramNumero: number;
  }[];
}

function formatTime(time: string | number): string {
  if (typeof time === 'number') {
    return '00:00';
  }
  return time.substring(0, 5);
}

function determineStatut(heureDebut: string): string {
  const now = new Date();
  const currentHour = now.getHours();
  const currentMinute = now.getMinutes();
  const currentTime = currentHour * 60 + currentMinute;
  
  const [hour, minute] = heureDebut.split(':').map(Number);
  const serviceTime = hour * 60 + minute;
  
  if (serviceTime <= currentTime && currentTime <= serviceTime + 480) {
    return 'En service';
  } else if (serviceTime > currentTime && serviceTime - currentTime < 60) {
    return 'En retard';
  } else if (serviceTime > currentTime + 480) {
    return 'Repos';
  } else {
    return 'Pause';
  }
}

function generatePhoneNumber(id: number): string {
  const base = 600000000 + id * 1000;
  return `0${Math.floor(base / 10000000)} ${Math.floor((base % 10000000) / 100000)} ${Math.floor((base % 100000) / 1000)} ${Math.floor((base % 1000) / 10)} ${base % 10}${Math.floor(Math.random() * 10)}`;
}

export function getConducteurs(): Conducteur[] {
  const servicesByDriver: { [key: number]: ServiceRaw[] } = {};
  
  servicesData.forEach(service => {
    const driverId = service['Services  S2 - Hiver 2025 '];
    if (!servicesByDriver[driverId]) {
      servicesByDriver[driverId] = [];
    }
    servicesByDriver[driverId].push(service);
  });
  
  const conducteurs: Conducteur[] = [];
  
  Object.entries(servicesByDriver).forEach(([driverIdStr, services]) => {
    const driverId = parseInt(driverIdStr);
    const driverInfo = { prenom: `Cond.`, nom: `${driverId}` };
    
    const firstServiceWithDuration = services.find(s => s['Unnamed: 8']);
    const dureeService = firstServiceWithDuration?.['Unnamed: 8'] || '8h00';
    
    const firstService = services[0];
    const lastService = services[services.length - 1];
    
    const heureDebut = formatTime(firstService['Unnamed: 1']);
    const heureFin = typeof lastService['Unnamed: 6'] === 'string' 
      ? formatTime(lastService['Unnamed: 6'])
      : '23:59';
    
    const stationDebut = firstService['Unnamed: 2'];
    const stationFin = lastService['Unnamed: 7'];
    
    const statut = determineStatut(heureDebut);
    
    let position = stationDebut;
    const now = new Date();
    const currentHour = now.getHours();
    
    for (const service of services) {
      const [hour] = service['Unnamed: 1'].split(':').map(Number);
      if (hour <= currentHour) {
        position = service['Unnamed: 2'];
      }
    }
    
    const conducteur: Conducteur = {
      id: driverId,
      nom: driverInfo.nom,
      prenom: driverInfo.prenom,
      matricule: `${driverId}`,
      statut,
      ligne: firstService['Unnamed: 3'],
      tram: `T2-${String(firstService['Unnamed: 5']).padStart(2, '0')}`,
      heures: `${heureDebut}-${heureFin}`,
      phone: generatePhoneNumber(driverId),
      position,
      stationDebut,
      stationFin,
      dureeService: dureeService || '8h00',
      services: services.map(s => ({
        heureDebut: formatTime(s['Unnamed: 1']),
        heureFin: typeof s['Unnamed: 6'] === 'string' ? formatTime(s['Unnamed: 6']) : '23:59',
        stationDebut: s['Unnamed: 2'],
        stationFin: s['Unnamed: 7'],
        tramNumero: s['Unnamed: 5']
      }))
    };
    
    conducteurs.push(conducteur);
  });
  
  return conducteurs.sort((a, b) => a.id - b.id);
}
